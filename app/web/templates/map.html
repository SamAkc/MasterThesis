{% extends 'base.html' %}

{% block head %}
<title>Karte</title>
<meta http-equiv="content-script-type" content="text/javascript" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="de" />
<link rel="stylesheet" type="text/css" href="../static/css/styles.css">
</link>
{% endblock %}

{% block javascript %}
<script type="text/javascript" src="https://openlayers.org/api/OpenLayers.js"></script>
<script type="text/javascript" src="https://openstreetmap.org/openlayers/OpenStreetMap.js"></script>
<script type="text/javascript" src="../static/js/tom.js"></script>
<script type="text/javascript">

    var map;
    var layer_mapnik;
    var layer_tah;
    var layer_markers;

    function drawmap() {
        OpenLayers.Lang.setCode('de');

        // coordinates of Bamberg:
        var lon = 10.893;
        var lat = 49.8897;
        var zoom = 15;

        map = new OpenLayers.Map('map', {
            projection: new OpenLayers.Projection("EPSG:900913"),
            displayProjection: new OpenLayers.Projection("EPSG:4326"),
            controls: [
                new OpenLayers.Control.Navigation(),
                new OpenLayers.Control.LayerSwitcher(),
                new OpenLayers.Control.PanZoomBar()],
            maxExtent:
                new OpenLayers.Bounds(-20037508.34, -20037508.34,
                    20037508.34, 20037508.34),
            numZoomLevels: 18,
            maxResolution: 156543,
            units: 'meters'
        });

        layer_mapnik = new OpenLayers.Layer.OSM.Mapnik("Mapnik");
        layer_markers = new OpenLayers.Layer.Markers("Address", {
            projection: new OpenLayers.Projection("EPSG:4326"),
            visibility: true, displayInLayerSwitcher: false
        });

        var stationsLayer = new OpenLayers.Layer.Vector({
            strategies: [new OpenLayers.Strategy.Fixed()],
            protocol: new OpenLayers.Protocol.HTTP({
                url: 'http://localhost:5000/static/stations.kml',
                format: new OpenLayers.Format.KML({
                    extractStyles: true,
                    extractAttributes: true
                })
            })
        });

        var climatezonesLayer = new OpenLayers.Layer.Vector({
            strategies: [new OpenLayers.Strategy.Fixed()],
            protocol: new OpenLayers.Protocol.HTTP({
                url: 'http://localhost:5000/static/climatezones.kml',
                format: new OpenLayers.Format.KML({
                    extractStyles: true,
                    extractAttributes: true
                })
            })
        });

        map.addLayers([layer_mapnik, layer_markers, stationsLayer, climatezonesLayer]);

        jumpTo(lon, lat, zoom);
    }

    document.addEventListener('DOMContentLoaded', function () {
        var chatContainer = document.getElementById('chat-container');
        var chatMessages = document.getElementById('chat-messages');
        var chatInput = document.getElementById('chat-input');
        var sendButton = document.getElementById('send-button');

        sendButton.addEventListener('click', function () {
            sendMessage();
        });

        chatInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function sendMessage() {
            var messageText = chatInput.value.trim();
            if (messageText !== '') {
                var messageElement = document.createElement('div');
                messageElement.className = 'chat-message';
                messageElement.textContent = 'Du: ' + messageText;
                chatMessages.appendChild(messageElement);
                chatInput.value = '';
                // TODO: enter code to process message or to respond
            }
        }
    });

</script>
{% endblock %}

{% block content %}
<div id="chat-container">
    <div id="chat-messages"></div>
    <input type="text" id="chat-input" placeholder="Nachricht eingeben">
    <button id="send-button">Senden</button>
</div>
<div id="map">
</div>
<div id="OSM-footer">
    <div id="osm">Â© <a href="https://www.openstreetmap.org">OpenStreetMap</a>
        <a href="https://www.openstreetmap.org/copyright">Mitwirkende</a>,
        <a href="https://opendatacommons.org/licenses/odbl/">ODbL</a>
    </div>
</div>

{% endblock %}